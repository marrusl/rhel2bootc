# === Base Image ===
# Detected: Red Hat Enterprise Linux 9.6 (Plow)
FROM registry.redhat.io/rhel9/rhel-bootc:9.6

# === Repository Configuration ===
# Detected: 1 repo file(s)
COPY config/etc/yum.repos.d/ /etc/yum.repos.d/

# === Package Installation ===
# Detected: 10 packages added beyond baseline
RUN dnf install -y \
    bash-completion \
    curl \
    cyrus-sasl-lib \
    httpd \
    httpd-filesystem \
    mod_ssl \
    policycoreutils \
    rsync \
    tar \
    vim-minimal \
    && dnf clean all

# === Service Enablement ===
# Detected: 2 non-default enabled, 0 disabled
RUN systemctl enable httpd.service firewalld.service

# === Configuration Files ===
# Detected: 3 modified RPM-owned configs, 7 unowned configs
COPY config/etc/ /etc/

# === Scheduled Tasks ===
# Converted from cron: 1 timer(s)
COPY config/etc/systemd/system/ /etc/systemd/system/
RUN systemctl enable cron-hourly-job.timer

# === Non-RPM Software ===
# FIXME: verify installation method for each item
# COPY config/opt/dummy /opt/dummy

# === Container Workloads (Quadlet) ===
COPY quadlet/ /etc/containers/systemd/

# === Users and Groups ===
RUN groupadd -g 65534 nobody
RUN groupadd -g 1000 jdoe
RUN useradd -u 65534 -g 65534 -m nobody
RUN useradd -u 1000 -g 1000 -m jdoe

# === Kernel Configuration ===
# Detected: custom kernel args
# RUN rpm-ostree kargs --append=...  # review and add as needed

# === SELinux Customizations ===
# Add COPY config/selinux/ and RUN semodule -i /tmp/selinux/*.pp if custom modules are in config/

# === tmpfiles.d for /var structure ===
# Directories created on every boot; /var is not updated by bootc after bootstrap.
COPY config/etc/tmpfiles.d/ /etc/tmpfiles.d/

# === Network / Kickstart ===
# NOTE: Interface-specific config (DHCP, DNS) should be applied via kickstart at deploy time.
